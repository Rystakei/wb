
<!-- <link rel="stylesheet" type="text/css" href="style.css">
<link href="http:////netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
<link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
 -->



<!-- <div class= "half1">
</div>
<div class="half2">
</div> -->
<div class="container">

<div class = "half">
<table>
  <tr id="labels">
      <th>Country</th>
      <th>ID</th>
      <th>Tried It</th>
      <th>Haven't Tried It</th>
      <th>Not Sure</th>
    </tr>

<% @countries.each do |country| %>
    <tr id=<%=country.code%>>
      <td><span class="country"><%= country.name %></span></td>
      <td><%=country.id%></td>
      <td><input type="radio" name="<%=country.id%>" value="1"></td>
      <td><input type="radio" name="<%=country.id%>" value="2"></td>
      <td><input type="radio" name="<%=country.id%>" value="3"></td>
      </tr>
<% end %>
</table>
</div>


  <div>
    <h2>worldbites</h2>
    <h3>You've tried food from 100/200 (50%) of the world's countries. </h3>
 
    <div class="main">
      <div id="worldmap"></div>
    </div>
     <div id="results"><p>Hey, doesn't look like you've sampled any Afghani food yet.</p>
     <p>Why don't you check out some of these nearby restaurants?</p>
  </div>
</div>


  <script>


     $( document ).ready(function() {
        
   
  (function() {

      //var oneColor = {'US': 'green', 'MX':'red', 'CA':'blue'};
      map = new jvm.WorldMap({
          map: 'world_mill_en',
          container: $('#worldmap'),
          backgroundColor: '#FEE987',
          series: {
              regions: [{
                  attribute: 'fill'}]
          }
      });
      

      //map.series.regions[0].setValues(oneColor);
      function setColor(countryCode,color){
            var country = {};
          country[countryCode] = color;
          map.series.regions[0].setValues(country);
    

      }
        
      
      $('input:radio').on("click", function(){
        var radioSelection = $(this);
        var checkedOption = radioSelection.filter(':checked').val();
        var countryCode = radioSelection.parent().parent().attr('id');
        var countryID = radioSelection.attr('name');
        console.log("countryID's value is: " + countryID);
        console.log("The value of the checked selection is: " + checkedOption);
        console.log(checkedOption === "1");
         if(checkedOption === "1"){
          console.log("You've sampled food from" + countryCode);
          setColor(countryCode,'#ADE479');
        }
         else if(checkedOption === "2"){
          console.log("You haven't sampled food from" + countryCode);
          setColor(countryCode,'#A52C2C');
        }
         else{
          console.log("You're not sure if you've sampled food from" + countryCode);
          setColor(countryCode,'gray');
        }


	        	// 	$.ajax({
				      // url: '/countries/'+ countryID,
				      // type: 'PUT',
				      // data: {country: { status: checkedOption}, user_id : 1 },
				      // success: function(result) {
				      //     console.log("changed status to " + checkedOption.val());
				      // }

              $.ajax({
              url: '/countries/'+ 35000,
              type: 'PUT',
              data: {country: { status: checkedOption}, user_id : 1 },
              success: function(result) {
                  console.log("changed status to " + checkedOption.val());
              }
				  });
     
          // var countryCode = $(this).attr("id");
          // if ($(this).hasClass("unselected")){
          //     $(this).addClass("selected");
          //     $(this).removeClass("unselected");
          //     $('body').append("Selected--Yellow"); 
          //     setColor(countryCode,'yellow');
          // }
          // else
          // {
          //     $(this).addClass("unselected");
          //     $(this).removeClass("selected");
          //     $('body').append("Unselected -- Gray"); 
          //     setColor(countryCode,'gray');
          // }
    
      });
      
  })();
   });
  </script>


<script>
  var auth = { 
   
   consumerKey: "EUcoj33x9x0XScuxAU0Y2w", 
   consumerSecret: "-ZPlORm6Q5V_b5OmltDNk2mwGgc",
   accessToken: "Ao_8q4xsHf06mQ-SGdhePM0BHIii15uC",
   accessTokenSecret: "WQGiHuuVgGoMd6h2Bi15EPYLhng",
   serviceProvider: { 
     signatureMethod: "HMAC-SHA1"
   }
 };

 var terms = 'food';
 var category = 'afghani';
 var near = 'Philadelphia';

 var accessor = {
   consumerSecret: auth.consumerSecret,
   tokenSecret: auth.accessTokenSecret
 };

 parameters = [];
 parameters.push(['term', terms]);
 parameters.push(['category_filter',category]);
 parameters.push(['location', near]);
 parameters.push(['callback', 'cb']);
 parameters.push(['oauth_consumer_key', auth.consumerKey]);
 parameters.push(['oauth_consumer_secret', auth.consumerSecret]);
 parameters.push(['oauth_token', auth.accessToken]);
 parameters.push(['oauth_signature_method', 'HMAC-SHA1']);

 var message = { 
   'action': 'http://api.yelp.com/v2/search',
   'method': 'GET',
   'parameters': parameters 
 };

 OAuth.setTimestampAndNonce(message);
 OAuth.SignatureMethod.sign(message, accessor);

 var parameterMap = OAuth.getParameterMap(message.parameters);
 parameterMap.oauth_signature = OAuth.percentEncode(parameterMap.oauth_signature)
 console.log(parameterMap);

 $.ajax({
   'url': message.action,
   'data': parameterMap,
   'cache': true,
   'dataType': 'jsonp',
   'jsonpCallback': 'cb',
   'success': function(data, textStats, XMLHttpRequest) {
     console.log(data);
     console.log("Data!" + data[0]);

       $.each(data["businesses"], function(key, val) {
       		$('#results').append('<div class="result result'+key+'">');
       		$('.result'+key).append("<img src='"+data["businesses"][key]["image_url"] + "' class='yelp'><p>");
       		$('.result'+key).append("Name:" + data["businesses"][key]["name"] + "<p>");
   			$('.result'+key).append("URL:" + data["businesses"][key]["url"] + "<p>");
   			$('.result'+key).append("Phone:" + data["businesses"][key]["phone"] + "<p>");
   			$('.result'+key).append("Type of Cuisine:" + data["businesses"][key]["categories"] + "<p>");
   		});
   }
 });
</script>

<br />

<%= link_to 'New Country', new_country_path %>
